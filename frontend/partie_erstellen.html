<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partie erstellen - WIZARD Turnier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <i class="bi-arrow-left"></i> Zurück
        </a>
        <span class="navbar-brand mb-0 h1">
          <i class="bi-magic"></i> WIZARD Turnier
        </span>
        <span class="navbar-text">
          <span id="selectedTable" class="badge bg-light text-dark">Tisch: -</span>
        </span>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
      <h1 id="title" class="text-center mb-4">Neue Partie erstellen</h1>

      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          
          <!-- Tischauswahl -->
          <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
              <i class="bi-grid-3x3"></i> Tisch auswählen
            </div>
            <div class="card-body">
              <label for="tableSelect" class="form-label">Tisch (A-Z)</label>
              <select id="tableSelect" class="form-select form-select-lg mb-3" onchange="updateTableBadge()">
                <option value="" selected>Bitte Tisch wählen...</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
                <option value="H">H</option>
                <option value="I">I</option>
                <option value="J">J</option>
                <option value="K">K</option>
                <option value="L">L</option>
                <option value="M">M</option>
                <option value="N">N</option>
                <option value="O">O</option>
                <option value="P">P</option>
                <option value="Q">Q</option>
                <option value="R">R</option>
                <option value="S">S</option>
                <option value="T">T</option>
                <option value="U">U</option>
                <option value="V">V</option>
                <option value="W">W</option>
                <option value="X">X</option>
                <option value="Y">Y</option>
                <option value="Z">Z</option>
              </select>
            </div>
          </div>

          <!-- Spieleranzahl -->
          <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
              <i class="bi-people-fill"></i> Anzahl der Spieler
            </div>
            <div class="card-body">
              <label for="playerCount" class="form-label">Spieleranzahl (3-5)</label>
              <select id="playerCount" class="form-select form-select-lg mb-3" onchange="updatePlayerInputs()">
                <option value="3">3 Spieler</option>
                <option value="4" selected>4 Spieler</option>
                <option value="5">5 Spieler</option>
              </select>
            </div>
          </div>

          <!-- Spieler eintragen -->
          <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
              <i class="bi-person-badge"></i> Spieler eintragen
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">Gib die Spieler-Nummern (01-99) ein:</p>
              
              <div id="playerInputsContainer">
                <div class="mb-3">
                  <label for="player1Number" class="form-label">Spieler 1</label>
                  <input type="number" class="form-control" id="player1Number" min="1" max="99" placeholder="01-99" oninput="validatePlayerNumber(this)" />
                  <div class="invalid-feedback">Bitte eine Nummer zwischen 01 und 99 eingeben</div>
                </div>
                <div class="mb-3">
                  <label for="player2Number" class="form-label">Spieler 2</label>
                  <input type="number" class="form-control" id="player2Number" min="1" max="99" placeholder="01-99" oninput="validatePlayerNumber(this)" />
                  <div class="invalid-feedback">Bitte eine Nummer zwischen 01 und 99 eingeben</div>
                </div>
                <div class="mb-3">
                  <label for="player3Number" class="form-label">Spieler 3</label>
                  <input type="number" class="form-control" id="player3Number" min="1" max="99" placeholder="01-99" oninput="validatePlayerNumber(this)" />
                  <div class="invalid-feedback">Bitte eine Nummer zwischen 01 und 99 eingeben</div>
                </div>
                <div class="mb-3" id="player4Container">
                  <label for="player4Number" class="form-label">Spieler 4</label>
                  <input type="number" class="form-control" id="player4Number" min="1" max="99" placeholder="01-99" oninput="validatePlayerNumber(this)" />
                  <div class="invalid-feedback">Bitte eine Nummer zwischen 01 und 99 eingeben</div>
                </div>
                <div class="mb-3" id="player5Container" style="display: none;">
                  <label for="player5Number" class="form-label">Spieler 5</label>
                  <input type="number" class="form-control" id="player5Number" min="1" max="99" placeholder="01-99" oninput="validatePlayerNumber(this)" />
                  <div class="invalid-feedback">Bitte eine Nummer zwischen 01 und 99 eingeben</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="d-grid gap-2 mb-4">
            <button class="btn btn-success btn-lg" onclick="createPartie()">
              <i class="bi-check-circle-fill"></i> Partie starten
            </button>
          </div>

        </div>
      </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title"><i class="bi-exclamation-triangle-fill"></i> Fehler</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="errorModalBody">
            Fehler bei der Partie-Erstellung
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function updateTableBadge() {
        const select = document.getElementById('tableSelect')
        const badge = document.getElementById('selectedTable')
        if (select.value) {
          badge.textContent = 'Tisch: ' + select.value
          badge.classList.remove('bg-light', 'text-dark')
          badge.classList.add('bg-success')
        } else {
          badge.textContent = 'Tisch: -'
          badge.classList.remove('bg-success')
          badge.classList.add('bg-light', 'text-dark')
        }
      }

      function updatePlayerInputs() {
        const count = parseInt(document.getElementById('playerCount').value)
        document.getElementById('player4Container').style.display = count >= 4 ? 'block' : 'none'
        document.getElementById('player5Container').style.display = count >= 5 ? 'block' : 'none'
      }

      function validatePlayerNumber(input) {
        const value = parseInt(input.value)
        const isValid = !isNaN(value) && value >= 1 && value <= 99
        input.classList.toggle('is-invalid', !isValid && input.value !== '')
        input.classList.toggle('is-valid', isValid)
      }

      function showError(message) {
        document.getElementById('errorModalBody').textContent = message
        const modal = new bootstrap.Modal(document.getElementById('errorModal'))
        modal.show()
      }

      function createPartie() {
        const table = document.getElementById('tableSelect').value
        if (!table) {
          showError('Bitte wähle einen Tisch aus!')
          return
        }

        const playerCount = parseInt(document.getElementById('playerCount').value)
        const players = []
        const playerNumbers = new Set()

        for (let i = 1; i <= playerCount; i++) {
          const input = document.getElementById(`player${i}Number`)
          const value = parseInt(input.value)
          
          if (isNaN(value) || value < 1 || value > 99) {
            showError(`Spieler ${i}: Bitte eine gültige Nummer (01-99) eingeben!`)
            input.focus()
            return
          }

          if (playerNumbers.has(value)) {
            showError(`Spieler-Nummer ${value} wurde mehrfach vergeben!`)
            input.focus()
            return
          }

          playerNumbers.add(value)
          players.push(value.toString().padStart(2, '0'))
        }

        // Store in localStorage and redirect to partie.html
        const partieData = {
          tisch: table,
          spieler: players,
          timestamp: new Date().toISOString()
        }
        
        localStorage.setItem('currentPartie', JSON.stringify(partieData))
        window.location.href = 'partie.html'
      }

      // Initialize
      updatePlayerInputs()
    </script>
  </body>
</html>
